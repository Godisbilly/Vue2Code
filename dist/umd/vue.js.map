{"version":3,"file":"vue.js","sources":["../../src/observe/array.js","../../src/observe/index.js","../../src/state.js","../../src/compiler/index.js","../../src/init.js","../../src/index.js"],"sourcesContent":["// 重写数组中的部分方法\n\n// 获取数组的原型\nlet oldArrayProto = Array.prototype\n\n// newArrayProto.__proto__ = oldArrayProto\nexport let newArrayProto = Object.create(oldArrayProto)\n\n// 变异方法（能修改原数组的方法）\nlet methods = ['push', 'pop', 'shift', 'unshift', 'reverse', 'sort', 'splice']\n\nmethods.forEach(method => {\n  newArrayProto[method] = function (...args) {\n    // 重写了数组方法，但是调用的时候还是调用的原来的方法\n    // 函数劫持\n    // 这个this指的是调用数组方法的那个数组\n    const result = oldArrayProto[method].call(this, ...args)\n    // 需要对新增的数据进行劫持\n    let inserted\n    switch (method) {\n      case 'push':\n      case 'unshift':\n        inserted = args\n        break\n      case 'splice':\n        inserted = args.slice(2)\n        break\n      default:\n        break\n    }\n    if (inserted) {\n      let ob = this.__ob__\n      ob.observeArray(inserted)\n    }\n    // 这个result是数组的长度\n    return result\n  }\n})\n\n","import { newArrayProto } from './array.js'\nclass Observer {\n  constructor(data) {\n    // 给数组增加一个标识，如果数据上有__ob__属性，则说明这个属性被观测过\n    // data.__ob__ = this\n    Object.defineProperty(data, '__ob__', {\n      enumerable: false,\n      configurable: true,\n      writable: true,\n      value: this\n    })\n    // Object.defineProperty只能劫持已经存在的数据，后增的、删除的属性都不能被检测到，因此Vue2中新增了一些API，如$set、$delete\n    // 遍历对象\n    if (Array.isArray(data)) {\n      // 重写数组中的方法\n      data.__proto__ = newArrayProto\n      // 对数组中的对象数据进行劫持\n      this.observeArray(data)\n      //需要保留数组原有的特性，并且重写部分方法\n    } else {\n      this.walk(data)\n    }\n  }\n\n  walk (data) {\n    // 遍历对象，对属性依次劫持\n    // 将数据属性转换为访问器属性\n    Object.keys(data).forEach(key => {\n      defineReactive(data, key, data[key])\n    })\n  }\n\n  observeArray (data) {\n    // 数组中的对象可以被检测到，不是对象属性的在进入到observe函数中就已经被return了\n    data.forEach(v => observe(v))\n  }\n}\n\nfunction defineReactive (target, key, value) {\n  // 如果属性值是一个对象，那么需要递归劫持\n  if (typeof value === 'object') {\n    observe(value)\n  }\n\n  // 重新定义属性，将数据属性转换为访问器属性\n  Object.defineProperty(target, key, {\n    get () {\n      return value\n    },\n    set (newValue) {\n      if (newValue === value) return\n      value = newValue\n    }\n  })\n}\n\n\n\nexport function observe (data) {\n  // 只对有效对象进行劫持\n  if (typeof data !== 'object' || data === null) return\n\n  // 如果一个对象被劫持过，那就不需要再被劫持了\n  // 判断一个对象是否被劫持过，可以增添一个实例，用实例来判断是否被劫持过\n  // 如果data上有__ob__属性，则说明这个对象已经被劫持过了\n  if (data.__ob__ instanceof Observer) return data.__ob__\n\n  return new Observer(data)\n}","import { observe } from './observe/index.js'\n\nexport function initState (vm) {\n  const opts = vm.$options\n  if (opts.data) {\n    initData(vm)\n  }\n}\n\nfunction proxy (vm, target, key) {\n  Object.defineProperty(vm, key, {\n    get () {\n      return vm[target][key]\n    },\n    set (newValue) {\n      if (newValue === vm[target][key]) return\n      vm[target][key] = newValue\n    }\n  })\n}\n\nfunction initData (vm) {\n  let data = vm.$options.data\n  // data可能是函数，也可能是对象\n  data = typeof data === 'function' ? data.call(vm) : data\n  // 对数据进行劫持，vue2里采用了Object.defineProperty\n  observe(data)\n  // 劫持之后，将data挂载到vm上\n  vm._data = data\n  // 将vm._data用vm来代理\n  for (let key in data) {\n    proxy(vm, '_data', key)\n  }\n}","export function compileToFunction (template) {\n  // 对模板进行编译\n  // 将template转换成ast语法树\n  // 生成render方法（render方法执行后的返回结果就是虚拟DOM）\n  console.log('compileToFunction', template)\n}","import { initState } from \"./state.js\"\nimport { compileToFunction } from \"./compiler/index.js\"\n\nexport function initMixin (Vue) {\n  // 初始化操作\n  Vue.prototype._init = function (options) {\n    // 先将options挂载到vue实例上\n    // 接下来就是处理options\n    const vm = this\n    vm.$options = options\n\n    // 初始化状态\n    initState(vm)\n\n\n    if (options.el) {\n      // 实现数据的挂载\n      vm.$mount(options.el)\n    }\n  }\n\n  Vue.prototype.$mount = function (el) {\n    const vm = this\n    const opts = vm.$options\n    if (!opts.render) {\n      // 先进行查找，有没有render函数，如果没有renderh函数，再看一下是否写了template，如果写了template，就用template，没有则用el获取template\n      let template\n      if (opts.template) {\n        template = opts.template\n      } else {\n        if (opts.el) {\n          const div = document.querySelector(el)\n          template = div.outerHTML\n        }\n      }\n      if (template) {\n        opts.render = compileToFunction(template)\n        // jsx最终会被编译成h('xxx')\n      }\n    }\n    if (typeof opts.render === 'function') opts.render()\n\n    // script标签引用的vue.global.js  这个编译过程是在浏览器中运行的\n    // runtime是不包含模板编译的，整个编译是打包的时候通过loader来转译.vue文件的，用runtime的时候不能用template\n  }\n}","import { initMixin } from './init.js'\n\n\nfunction Vue (options) {\n  this._init(options)\n}\n\ninitMixin(Vue)\n\nexport default Vue"],"names":["oldArrayProto","Array","prototype","newArrayProto","Object","create","methods","forEach","method","args","result","call","inserted","slice","ob","__ob__","observeArray","Observer","data","defineProperty","enumerable","configurable","writable","value","isArray","__proto__","walk","keys","key","defineReactive","v","observe","target","get","set","newValue","initState","vm","opts","$options","initData","proxy","_data","compileToFunction","template","console","log","initMixin","Vue","_init","options","el","$mount","render","div","document","querySelector","outerHTML"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;EAAA;EAEA;EACA,IAAIA,aAAa,GAAGC,KAAK,CAACC,SAA1B;;EAGO,IAAIC,aAAa,GAAGC,MAAM,CAACC,MAAP,CAAcL,aAAd,CAApB;;EAGP,IAAIM,OAAO,GAAG,CAAC,MAAD,EAAS,KAAT,EAAgB,OAAhB,EAAyB,SAAzB,EAAoC,SAApC,EAA+C,MAA/C,EAAuD,QAAvD,CAAd,CAAA;EAEAA,OAAO,CAACC,OAAR,CAAgB,UAAAC,MAAM,EAAI;EACxBL,EAAAA,aAAa,CAACK,MAAD,CAAb,GAAwB,YAAmB;EAAA,IAAA,IAAA,qBAAA,CAAA;;EAAA,IAAA,KAAA,IAAA,IAAA,GAAA,SAAA,CAAA,MAAA,EAANC,IAAM,GAAA,IAAA,KAAA,CAAA,IAAA,CAAA,EAAA,IAAA,GAAA,CAAA,EAAA,IAAA,GAAA,IAAA,EAAA,IAAA,EAAA,EAAA;QAANA,IAAM,CAAA,IAAA,CAAA,GAAA,SAAA,CAAA,IAAA,CAAA,CAAA;EAAA,KAAA;;EACzC;EACA;EACA;EACA,IAAA,IAAMC,MAAM,GAAG,CAAAV,qBAAAA,GAAAA,aAAa,CAACQ,MAAD,CAAb,EAAsBG,IAAtB,+BAA2B,IAA3B,CAAA,CAAA,MAAA,CAAoCF,IAApC,CAAA,CAAf,CAJyC;;;EAMzC,IAAA,IAAIG,QAAJ,CAAA;;EACA,IAAA,QAAQJ,MAAR;EACE,MAAA,KAAK,MAAL,CAAA;EACA,MAAA,KAAK,SAAL;EACEI,QAAAA,QAAQ,GAAGH,IAAX,CAAA;EACA,QAAA,MAAA;;EACF,MAAA,KAAK,QAAL;EACEG,QAAAA,QAAQ,GAAGH,IAAI,CAACI,KAAL,CAAW,CAAX,CAAX,CAAA;EACA,QAAA,MAAA;EAPJ,KAAA;;EAWA,IAAA,IAAID,QAAJ,EAAc;QACZ,IAAIE,EAAE,GAAG,IAAA,CAAKC,MAAd,CAAA;QACAD,EAAE,CAACE,YAAH,CAAgBJ,QAAhB,CAAA,CAAA;EACD,KArBwC;;;EAuBzC,IAAA,OAAOF,MAAP,CAAA;KAvBF,CAAA;EAyBD,CA1BD,CAAA;;MCVMO;EACJ,EAAA,SAAA,QAAA,CAAYC,IAAZ,EAAkB;EAAA,IAAA,eAAA,CAAA,IAAA,EAAA,QAAA,CAAA,CAAA;;EAChB;EACA;EACAd,IAAAA,MAAM,CAACe,cAAP,CAAsBD,IAAtB,EAA4B,QAA5B,EAAsC;EACpCE,MAAAA,UAAU,EAAE,KADwB;EAEpCC,MAAAA,YAAY,EAAE,IAFsB;EAGpCC,MAAAA,QAAQ,EAAE,IAH0B;EAIpCC,MAAAA,KAAK,EAAE,IAAA;EAJ6B,KAAtC,EAHgB;EAUhB;;EACA,IAAA,IAAItB,KAAK,CAACuB,OAAN,CAAcN,IAAd,CAAJ,EAAyB;EACvB;EACAA,MAAAA,IAAI,CAACO,SAAL,GAAiBtB,aAAjB,CAFuB;;EAIvB,MAAA,IAAA,CAAKa,YAAL,CAAkBE,IAAlB,CAAA,CAJuB;EAMxB,KAND,MAMO;QACL,IAAKQ,CAAAA,IAAL,CAAUR,IAAV,CAAA,CAAA;EACD,KAAA;EACF,GAAA;;;;EAED,IAAA,KAAA,EAAA,SAAA,IAAA,CAAMA,IAAN,EAAY;EACV;EACA;QACAd,MAAM,CAACuB,IAAP,CAAYT,IAAZ,EAAkBX,OAAlB,CAA0B,UAAAqB,GAAG,EAAI;UAC/BC,cAAc,CAACX,IAAD,EAAOU,GAAP,EAAYV,IAAI,CAACU,GAAD,CAAhB,CAAd,CAAA;SADF,CAAA,CAAA;EAGD,KAAA;;;EAED,IAAA,KAAA,EAAA,SAAA,YAAA,CAAcV,IAAd,EAAoB;EAClB;EACAA,MAAAA,IAAI,CAACX,OAAL,CAAa,UAAAuB,CAAC,EAAA;UAAA,OAAIC,OAAO,CAACD,CAAD,CAAX,CAAA;SAAd,CAAA,CAAA;EACD,KAAA;;;;;;EAGH,SAASD,cAAT,CAAyBG,MAAzB,EAAiCJ,GAAjC,EAAsCL,KAAtC,EAA6C;EAC3C;EACA,EAAA,IAAI,OAAOA,CAAAA,KAAP,CAAiB,KAAA,QAArB,EAA+B;MAC7BQ,OAAO,CAACR,KAAD,CAAP,CAAA;EACD,GAJ0C;;;EAO3CnB,EAAAA,MAAM,CAACe,cAAP,CAAsBa,MAAtB,EAA8BJ,GAA9B,EAAmC;EACjCK,IAAAA,GADiC,EAC1B,SAAA,GAAA,GAAA;EACL,MAAA,OAAOV,KAAP,CAAA;OAF+B;MAIjCW,GAJiC,EAAA,SAAA,GAAA,CAI5BC,QAJ4B,EAIlB;QACb,IAAIA,QAAQ,KAAKZ,KAAjB,EAAwB,OAAA;EACxBA,MAAAA,KAAK,GAAGY,QAAR,CAAA;EACD,KAAA;KAPH,CAAA,CAAA;EASD,CAAA;;EAIM,SAASJ,OAAT,CAAkBb,IAAlB,EAAwB;EAC7B;IACA,IAAI,OAAA,CAAOA,IAAP,CAAA,KAAgB,QAAhB,IAA4BA,IAAI,KAAK,IAAzC,EAA+C,OAFlB;EAK7B;EACA;;IACA,IAAIA,IAAI,CAACH,MAAL,YAAuBE,QAA3B,EAAqC,OAAOC,IAAI,CAACH,MAAZ,CAAA;EAErC,EAAA,OAAO,IAAIE,QAAJ,CAAaC,IAAb,CAAP,CAAA;EACD;;EClEM,SAASkB,SAAT,CAAoBC,EAApB,EAAwB;EAC7B,EAAA,IAAMC,IAAI,GAAGD,EAAE,CAACE,QAAhB,CAAA;;IACA,IAAID,IAAI,CAACpB,IAAT,EAAe;MACbsB,QAAQ,CAACH,EAAD,CAAR,CAAA;EACD,GAAA;EACF,CAAA;;EAED,SAASI,KAAT,CAAgBJ,EAAhB,EAAoBL,MAApB,EAA4BJ,GAA5B,EAAiC;EAC/BxB,EAAAA,MAAM,CAACe,cAAP,CAAsBkB,EAAtB,EAA0BT,GAA1B,EAA+B;EAC7BK,IAAAA,GAD6B,EACtB,SAAA,GAAA,GAAA;EACL,MAAA,OAAOI,EAAE,CAACL,MAAD,CAAF,CAAWJ,GAAX,CAAP,CAAA;OAF2B;MAI7BM,GAJ6B,EAAA,SAAA,GAAA,CAIxBC,QAJwB,EAId;QACb,IAAIA,QAAQ,KAAKE,EAAE,CAACL,MAAD,CAAF,CAAWJ,GAAX,CAAjB,EAAkC,OAAA;EAClCS,MAAAA,EAAE,CAACL,MAAD,CAAF,CAAWJ,GAAX,IAAkBO,QAAlB,CAAA;EACD,KAAA;KAPH,CAAA,CAAA;EASD,CAAA;;EAED,SAASK,QAAT,CAAmBH,EAAnB,EAAuB;IACrB,IAAInB,IAAI,GAAGmB,EAAE,CAACE,QAAH,CAAYrB,IAAvB,CADqB;;EAGrBA,EAAAA,IAAI,GAAG,OAAOA,IAAP,KAAgB,UAAhB,GAA6BA,IAAI,CAACP,IAAL,CAAU0B,EAAV,CAA7B,GAA6CnB,IAApD,CAHqB;;EAKrBa,EAAAA,OAAO,CAACb,IAAD,CAAP,CALqB;;EAOrBmB,EAAAA,EAAE,CAACK,KAAH,GAAWxB,IAAX,CAPqB;;EASrB,EAAA,KAAK,IAAIU,GAAT,IAAgBV,IAAhB,EAAsB;EACpBuB,IAAAA,KAAK,CAACJ,EAAD,EAAK,OAAL,EAAcT,GAAd,CAAL,CAAA;EACD,GAAA;EACF;;ECjCM,SAASe,iBAAT,CAA4BC,QAA5B,EAAsC;EAC3C;EACA;EACA;EACAC,EAAAA,OAAO,CAACC,GAAR,CAAY,mBAAZ,EAAiCF,QAAjC,CAAA,CAAA;EACD;;ECFM,SAASG,SAAT,CAAoBC,GAApB,EAAyB;EAC9B;EACAA,EAAAA,GAAG,CAAC9C,SAAJ,CAAc+C,KAAd,GAAsB,UAAUC,OAAV,EAAmB;EACvC;EACA;MACA,IAAMb,EAAE,GAAG,IAAX,CAAA;EACAA,IAAAA,EAAE,CAACE,QAAH,GAAcW,OAAd,CAJuC;;MAOvCd,SAAS,CAACC,EAAD,CAAT,CAAA;;MAGA,IAAIa,OAAO,CAACC,EAAZ,EAAgB;EACd;EACAd,MAAAA,EAAE,CAACe,MAAH,CAAUF,OAAO,CAACC,EAAlB,CAAA,CAAA;EACD,KAAA;KAbH,CAAA;;EAgBAH,EAAAA,GAAG,CAAC9C,SAAJ,CAAckD,MAAd,GAAuB,UAAUD,EAAV,EAAc;MACnC,IAAMd,EAAE,GAAG,IAAX,CAAA;EACA,IAAA,IAAMC,IAAI,GAAGD,EAAE,CAACE,QAAhB,CAAA;;EACA,IAAA,IAAI,CAACD,IAAI,CAACe,MAAV,EAAkB;EAChB;EACA,MAAA,IAAIT,QAAJ,CAAA;;QACA,IAAIN,IAAI,CAACM,QAAT,EAAmB;UACjBA,QAAQ,GAAGN,IAAI,CAACM,QAAhB,CAAA;EACD,OAFD,MAEO;UACL,IAAIN,IAAI,CAACa,EAAT,EAAa;EACX,UAAA,IAAMG,GAAG,GAAGC,QAAQ,CAACC,aAAT,CAAuBL,EAAvB,CAAZ,CAAA;YACAP,QAAQ,GAAGU,GAAG,CAACG,SAAf,CAAA;EACD,SAAA;EACF,OAAA;;EACD,MAAA,IAAIb,QAAJ,EAAc;UACZN,IAAI,CAACe,MAAL,GAAcV,iBAAiB,CAACC,QAAD,CAA/B,CADY;EAGb,OAAA;EACF,KAAA;;MACD,IAAI,OAAON,IAAI,CAACe,MAAZ,KAAuB,UAA3B,EAAuCf,IAAI,CAACe,MAAL,EAAA,CAnBJ;EAsBnC;KAtBF,CAAA;EAwBD;;EC1CD,SAASL,GAAT,CAAcE,OAAd,EAAuB;IACrB,IAAKD,CAAAA,KAAL,CAAWC,OAAX,CAAA,CAAA;EACD,CAAA;;EAEDH,SAAS,CAACC,GAAD,CAAT;;;;;;;;"}